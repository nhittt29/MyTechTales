<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>WebSocket với JavaScript cho thời gian thực | My Tech Tales</title>
<meta name="keywords" content="JavaScript, WebSocket, Thời gian thực">
<meta name="description" content="Hướng dẫn sử dụng WebSocket trong JavaScript để xây dựng ứng dụng thời gian thực như chat và thông báo, cập nhật ngày 18/10/2025.">
<meta name="author" content="">
<link rel="canonical" href="https://nhittt29.github.io/MyTechTales/blog/javascript/websocket-js/">
<link crossorigin="anonymous" href="/MyTechTales/assets/css/stylesheet.a482bf00fa5c046040ef7973ad5fdf5657890cacb596c93f1382f664ca542074.css" integrity="sha256-pIK/APpcBGBA73lzrV/fVleJDKy1lsk/E4L2ZMpUIHQ=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://nhittt29.github.io/MyTechTales/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://nhittt29.github.io/MyTechTales/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://nhittt29.github.io/MyTechTales/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://nhittt29.github.io/MyTechTales/apple-touch-icon.png">
<link rel="mask-icon" href="https://nhittt29.github.io/MyTechTales/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://nhittt29.github.io/MyTechTales/blog/javascript/websocket-js/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="https://nhittt29.github.io/MyTechTales/blog/javascript/websocket-js/">
  <meta property="og:site_name" content="My Tech Tales">
  <meta property="og:title" content="WebSocket với JavaScript cho thời gian thực">
  <meta property="og:description" content="Hướng dẫn sử dụng WebSocket trong JavaScript để xây dựng ứng dụng thời gian thực như chat và thông báo, cập nhật ngày 18/10/2025.">
  <meta property="og:locale" content="vi">
  <meta property="og:type" content="article">
    <meta property="article:section" content="blog">
    <meta property="article:published_time" content="2025-10-07T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-10-07T00:00:00+00:00">
    <meta property="article:tag" content="JavaScript">
    <meta property="article:tag" content="WebSocket">
    <meta property="article:tag" content="Thời Gian Thực">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="WebSocket với JavaScript cho thời gian thực">
<meta name="twitter:description" content="Hướng dẫn sử dụng WebSocket trong JavaScript để xây dựng ứng dụng thời gian thực như chat và thông báo, cập nhật ngày 18/10/2025.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Blogs",
      "item": "https://nhittt29.github.io/MyTechTales/blog/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Lập trình JavaScript",
      "item": "https://nhittt29.github.io/MyTechTales/blog/javascript/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "WebSocket với JavaScript cho thời gian thực",
      "item": "https://nhittt29.github.io/MyTechTales/blog/javascript/websocket-js/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "WebSocket với JavaScript cho thời gian thực",
  "name": "WebSocket với JavaScript cho thời gian thực",
  "description": "Hướng dẫn sử dụng WebSocket trong JavaScript để xây dựng ứng dụng thời gian thực như chat và thông báo, cập nhật ngày 18/10/2025.",
  "keywords": [
    "JavaScript", "WebSocket", "Thời gian thực"
  ],
  "articleBody": "1. Giới thiệu WebSocket là một giao thức cho phép giao tiếp hai chiều liên tục giữa client và server, lý tưởng cho các ứng dụng cần cập nhật thời gian thực.\nJavaScript cung cấp WebSocket API native để kết nối với server (như Java backend), tạo ra trải nghiệm người dùng mượt mà.\nBài viết này, được cập nhật dựa trên thông tin từ sáng thứ Năm, ngày 16/10/2025 lúc 10:07 AM +07, sẽ hướng dẫn chi tiết cách triển khai WebSocket trong JavaScript.\n2. Vai trò của WebSocket trong ứng dụng web WebSocket đóng vai trò quan trọng trong các ứng dụng hiện đại:\nGiao tiếp hai chiều: Client và server có thể gửi dữ liệu bất cứ lúc nào mà không cần polling. Thời gian thực: Cập nhật tức thì, phù hợp cho chat hoặc thông báo. Tiết kiệm tài nguyên: Giảm số lượng HTTP request so với phương pháp truyền thống. Trải nghiệm tốt: Phản hồi nhanh chóng, nâng cao trải nghiệm người dùng. 3. So sánh với các phương pháp khác Phương pháp Ưu điểm Nhược điểm HTTP Polling Đơn giản, dễ triển khai Nhiều request, hiệu suất thấp Long Polling Gần thời gian thực Vẫn cần nhiều request Server-Sent Events Server gửi dữ liệu một chiều Chỉ hỗ trợ một chiều WebSocket Hai chiều, thời gian thực Phức tạp hơn trong triển khai 4. Cách triển khai WebSocket trong JavaScript JavaScript cung cấp các bước cơ bản để sử dụng WebSocket:\nKết nối: Sử dụng new WebSocket(url) với URL ws:// hoặc wss://. Sự kiện: Xử lý onopen, onmessage, onclose, onerror để theo dõi trạng thái. Gửi dữ liệu: Sử dụng send() để truyền tin nhắn đến server. Đóng kết nối: Gọi close() khi không cần thiết. 5. Ứng dụng thực tế Chat application: Tin nhắn hiển thị tức thì cho tất cả người dùng. Live notification: Thông báo mới đến ngay khi có sự kiện. Real-time dashboard: Cập nhật dữ liệu tài chính hoặc thống kê liên tục. Collaborative editing: Nhiều người chỉnh sửa tài liệu cùng lúc, như Google Docs. 6. Ví dụ minh họa Dưới đây là ví dụ ứng dụng chat sử dụng WebSocket:\n// Class quản lý WebSocket chat class RealTimeChat { constructor(url) { this.socket = new WebSocket(url); this.messages = []; this.init(); } init() { // Xử lý kết nối mở this.socket.onopen = () =\u003e { console.log('Kết nối WebSocket thành công'); this.updateStatus('Đã kết nối với server'); }; // Nhận tin nhắn this.socket.onmessage = (event) =\u003e { const message = JSON.parse(event.data); this.addMessage(message); this.renderMessage(message); }; // Xử lý lỗi this.socket.onerror = (error) =\u003e { console.error('Lỗi WebSocket:', error); this.updateStatus('Lỗi kết nối, thử lại sau...'); }; // Xử lý ngắt kết nối this.socket.onclose = (event) =\u003e { console.log('Kết nối đóng:', event.code, event.reason); this.updateStatus('Mất kết nối, đang thử kết nối lại...'); setTimeout(() =\u003e this.reconnect(), 2000); }; // Gửi tin nhắn khi nhấn gửi document.getElementById('chat-form').addEventListener('submit', (e) =\u003e { e.preventDefault(); this.sendMessage(); }); } sendMessage() { const input = document.getElementById('message-input'); const message = input.value.trim(); if (message \u0026\u0026 this.socket.readyState === WebSocket.OPEN) { const messageData = { type: 'chat', content: message, timestamp: new Date().toISOString(), userId: 'user_' + Math.floor(Math.random() * 1000) }; this.socket.send(JSON.stringify(messageData)); input.value = ''; } } addMessage(message) { this.messages.push(message); if (this.messages.length \u003e 50) this.messages.shift(); // Giới hạn 50 tin nhắn } renderMessage(message) { const chatBox = document.getElementById('chat-box'); const messageDiv = document.createElement('div'); messageDiv.className = 'chat-message'; messageDiv.innerHTML = ` ${message.userId}: ${message.content} ${new Date(message.timestamp).toLocaleTimeString()} `; chatBox.appendChild(messageDiv); chatBox.scrollTop = chatBox.scrollHeight; } updateStatus(message) { const status = document.getElementById('chat-status'); status.textContent = message; status.className = 'status'; } reconnect() { if (this.socket.readyState === WebSocket.CLOSED) { this.socket = new WebSocket(this.socket.url); this.init(); } } } // Khởi tạo khi trang tải document.addEventListener('DOMContentLoaded', () =\u003e { new RealTimeChat('ws://localhost:8080/chat'); }); ",
  "wordCount" : "609",
  "inLanguage": "en",
  "datePublished": "2025-10-07T00:00:00Z",
  "dateModified": "2025-10-07T00:00:00Z",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://nhittt29.github.io/MyTechTales/blog/javascript/websocket-js/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "My Tech Tales",
    "logo": {
      "@type": "ImageObject",
      "url": "https://nhittt29.github.io/MyTechTales/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }
</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://nhittt29.github.io/MyTechTales/" accesskey="h" title="My Tech Tales (Alt + H)">My Tech Tales</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://nhittt29.github.io/MyTechTales/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="https://nhittt29.github.io/MyTechTales/blog/" title="Blog">
                    <span>Blog</span>
                </a>
            </li>
            <li>
                <a href="https://nhittt29.github.io/MyTechTales/profile/" title="Profile">
                    <span>Profile</span>
                </a>
            </li>
            <li>
                <a href="https://nhittt29.github.io/MyTechTales/search/" title="Tìm kiếm">
                    <span>Tìm kiếm</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://nhittt29.github.io/MyTechTales/">Home</a>&nbsp;»&nbsp;<a href="https://nhittt29.github.io/MyTechTales/blog/">Blogs</a>&nbsp;»&nbsp;<a href="https://nhittt29.github.io/MyTechTales/blog/javascript/">Lập trình JavaScript</a></div>
    <h1 class="post-title entry-hint-parent">
      WebSocket với JavaScript cho thời gian thực
    </h1>
    <div class="post-meta"><span title='2025-10-07 00:00:00 +0000 UTC'>October 7, 2025</span>&nbsp;·&nbsp;<span>3 min</span>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#1-gi%e1%bb%9bi-thi%e1%bb%87u" aria-label="1. Giới thiệu">1. Giới thiệu</a></li>
                <li>
                    <a href="#2-vai-tr%c3%b2-c%e1%bb%a7a-websocket-trong-%e1%bb%a9ng-d%e1%bb%a5ng-web" aria-label="2. Vai trò của WebSocket trong ứng dụng web">2. Vai trò của WebSocket trong ứng dụng web</a></li>
                <li>
                    <a href="#3-so-s%c3%a1nh-v%e1%bb%9bi-c%c3%a1c-ph%c6%b0%c6%a1ng-ph%c3%a1p-kh%c3%a1c" aria-label="3. So sánh với các phương pháp khác">3. So sánh với các phương pháp khác</a></li>
                <li>
                    <a href="#4-c%c3%a1ch-tri%e1%bb%83n-khai-websocket-trong-javascript" aria-label="4. Cách triển khai WebSocket trong JavaScript">4. Cách triển khai WebSocket trong JavaScript</a></li>
                <li>
                    <a href="#5-%e1%bb%a9ng-d%e1%bb%a5ng-th%e1%bb%b1c-t%e1%ba%bf" aria-label="5. Ứng dụng thực tế">5. Ứng dụng thực tế</a></li>
                <li>
                    <a href="#6-v%c3%ad-d%e1%bb%a5-minh-h%e1%bb%8da" aria-label="6. Ví dụ minh họa">6. Ví dụ minh họa</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="1-giới-thiệu">1. Giới thiệu<a hidden class="anchor" aria-hidden="true" href="#1-giới-thiệu">#</a></h2>
<p><strong>WebSocket</strong> là một giao thức cho phép giao tiếp hai chiều liên tục giữa client và server, lý tưởng cho các ứng dụng cần cập nhật thời gian thực.<br>
JavaScript cung cấp WebSocket API native để kết nối với server (như Java backend), tạo ra trải nghiệm người dùng mượt mà.<br>
Bài viết này, được cập nhật dựa trên thông tin từ sáng thứ Năm, ngày 16/10/2025 lúc 10:07 AM +07, sẽ hướng dẫn chi tiết cách triển khai WebSocket trong JavaScript.</p>
<p><img alt="WebSocket" loading="lazy" src="https://nhittt29.github.io/MyTechTales/images/websocket-js.png" title="WebSocket trong JavaScript"></p>
<h2 id="2-vai-trò-của-websocket-trong-ứng-dụng-web">2. Vai trò của WebSocket trong ứng dụng web<a hidden class="anchor" aria-hidden="true" href="#2-vai-trò-của-websocket-trong-ứng-dụng-web">#</a></h2>
<p>WebSocket đóng vai trò quan trọng trong các ứng dụng hiện đại:</p>
<ul>
<li>Giao tiếp hai chiều: Client và server có thể gửi dữ liệu bất cứ lúc nào mà không cần polling.</li>
<li>Thời gian thực: Cập nhật tức thì, phù hợp cho chat hoặc thông báo.</li>
<li>Tiết kiệm tài nguyên: Giảm số lượng HTTP request so với phương pháp truyền thống.</li>
<li>Trải nghiệm tốt: Phản hồi nhanh chóng, nâng cao trải nghiệm người dùng.</li>
</ul>
<h2 id="3-so-sánh-với-các-phương-pháp-khác">3. So sánh với các phương pháp khác<a hidden class="anchor" aria-hidden="true" href="#3-so-sánh-với-các-phương-pháp-khác">#</a></h2>
<table>
  <thead>
      <tr>
          <th>Phương pháp</th>
          <th>Ưu điểm</th>
          <th>Nhược điểm</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>HTTP Polling</strong></td>
          <td>Đơn giản, dễ triển khai</td>
          <td>Nhiều request, hiệu suất thấp</td>
      </tr>
      <tr>
          <td><strong>Long Polling</strong></td>
          <td>Gần thời gian thực</td>
          <td>Vẫn cần nhiều request</td>
      </tr>
      <tr>
          <td><strong>Server-Sent Events</strong></td>
          <td>Server gửi dữ liệu một chiều</td>
          <td>Chỉ hỗ trợ một chiều</td>
      </tr>
      <tr>
          <td><strong>WebSocket</strong></td>
          <td>Hai chiều, thời gian thực</td>
          <td>Phức tạp hơn trong triển khai</td>
      </tr>
  </tbody>
</table>
<h2 id="4-cách-triển-khai-websocket-trong-javascript">4. Cách triển khai WebSocket trong JavaScript<a hidden class="anchor" aria-hidden="true" href="#4-cách-triển-khai-websocket-trong-javascript">#</a></h2>
<p>JavaScript cung cấp các bước cơ bản để sử dụng WebSocket:</p>
<ul>
<li>Kết nối: Sử dụng <code>new WebSocket(url)</code> với URL <code>ws://</code> hoặc <code>wss://</code>.</li>
<li>Sự kiện: Xử lý <code>onopen</code>, <code>onmessage</code>, <code>onclose</code>, <code>onerror</code> để theo dõi trạng thái.</li>
<li>Gửi dữ liệu: Sử dụng <code>send()</code> để truyền tin nhắn đến server.</li>
<li>Đóng kết nối: Gọi <code>close()</code> khi không cần thiết.</li>
</ul>
<h2 id="5-ứng-dụng-thực-tế">5. Ứng dụng thực tế<a hidden class="anchor" aria-hidden="true" href="#5-ứng-dụng-thực-tế">#</a></h2>
<ul>
<li>Chat application: Tin nhắn hiển thị tức thì cho tất cả người dùng.</li>
<li>Live notification: Thông báo mới đến ngay khi có sự kiện.</li>
<li>Real-time dashboard: Cập nhật dữ liệu tài chính hoặc thống kê liên tục.</li>
<li>Collaborative editing: Nhiều người chỉnh sửa tài liệu cùng lúc, như Google Docs.</li>
</ul>
<h2 id="6-ví-dụ-minh-họa">6. Ví dụ minh họa<a hidden class="anchor" aria-hidden="true" href="#6-ví-dụ-minh-họa">#</a></h2>
<p>Dưới đây là ví dụ ứng dụng chat sử dụng WebSocket:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">// Class quản lý WebSocket chat
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RealTimeChat</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">constructor</span>(<span style="color:#a6e22e">url</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">socket</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">WebSocket</span>(<span style="color:#a6e22e">url</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">messages</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">init</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">init</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Xử lý kết nối mở
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">socket</span>.<span style="color:#a6e22e">onopen</span> <span style="color:#f92672">=</span> () =&gt; {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;Kết nối WebSocket thành công&#39;</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">updateStatus</span>(<span style="color:#e6db74">&#39;Đã kết nối với server&#39;</span>);
</span></span><span style="display:flex;"><span>        };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Nhận tin nhắn
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">socket</span>.<span style="color:#a6e22e">onmessage</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">event</span>) =&gt; {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">message</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">data</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">addMessage</span>(<span style="color:#a6e22e">message</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">renderMessage</span>(<span style="color:#a6e22e">message</span>);
</span></span><span style="display:flex;"><span>        };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Xử lý lỗi
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">socket</span>.<span style="color:#a6e22e">onerror</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">error</span>) =&gt; {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">&#39;Lỗi WebSocket:&#39;</span>, <span style="color:#a6e22e">error</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">updateStatus</span>(<span style="color:#e6db74">&#39;Lỗi kết nối, thử lại sau...&#39;</span>);
</span></span><span style="display:flex;"><span>        };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Xử lý ngắt kết nối
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">socket</span>.<span style="color:#a6e22e">onclose</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">event</span>) =&gt; {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;Kết nối đóng:&#39;</span>, <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">code</span>, <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">reason</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">updateStatus</span>(<span style="color:#e6db74">&#39;Mất kết nối, đang thử kết nối lại...&#39;</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">setTimeout</span>(() =&gt; <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">reconnect</span>(), <span style="color:#ae81ff">2000</span>);
</span></span><span style="display:flex;"><span>        };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Gửi tin nhắn khi nhấn gửi
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#39;chat-form&#39;</span>).<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#39;submit&#39;</span>, (<span style="color:#a6e22e">e</span>) =&gt; {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">preventDefault</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">sendMessage</span>();
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">sendMessage</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">input</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#39;message-input&#39;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">message</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">input</span>.<span style="color:#a6e22e">value</span>.<span style="color:#a6e22e">trim</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">message</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">socket</span>.<span style="color:#a6e22e">readyState</span> <span style="color:#f92672">===</span> <span style="color:#a6e22e">WebSocket</span>.<span style="color:#a6e22e">OPEN</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">messageData</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;chat&#39;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">content</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">message</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">timestamp</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">new</span> Date().<span style="color:#a6e22e">toISOString</span>(),
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">userId</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;user_&#39;</span> <span style="color:#f92672">+</span> Math.<span style="color:#a6e22e">floor</span>(Math.<span style="color:#a6e22e">random</span>() <span style="color:#f92672">*</span> <span style="color:#ae81ff">1000</span>)
</span></span><span style="display:flex;"><span>            };
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">socket</span>.<span style="color:#a6e22e">send</span>(<span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#a6e22e">messageData</span>));
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">input</span>.<span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">addMessage</span>(<span style="color:#a6e22e">message</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">messages</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">message</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">messages</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">50</span>) <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">messages</span>.<span style="color:#a6e22e">shift</span>(); <span style="color:#75715e">// Giới hạn 50 tin nhắn
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">renderMessage</span>(<span style="color:#a6e22e">message</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">chatBox</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#39;chat-box&#39;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">messageDiv</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;div&#39;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">messageDiv</span>.<span style="color:#a6e22e">className</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;chat-message&#39;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">messageDiv</span>.<span style="color:#a6e22e">innerHTML</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &lt;strong&gt;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">message</span>.<span style="color:#a6e22e">userId</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&lt;/strong&gt;: 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &lt;span&gt;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">message</span>.<span style="color:#a6e22e">content</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&lt;/span&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &lt;small&gt;</span><span style="color:#e6db74">${</span><span style="color:#66d9ef">new</span> Date(<span style="color:#a6e22e">message</span>.<span style="color:#a6e22e">timestamp</span>).<span style="color:#a6e22e">toLocaleTimeString</span>()<span style="color:#e6db74">}</span><span style="color:#e6db74">&lt;/small&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        `</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">chatBox</span>.<span style="color:#a6e22e">appendChild</span>(<span style="color:#a6e22e">messageDiv</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">chatBox</span>.<span style="color:#a6e22e">scrollTop</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">chatBox</span>.<span style="color:#a6e22e">scrollHeight</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">updateStatus</span>(<span style="color:#a6e22e">message</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">status</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#39;chat-status&#39;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">status</span>.<span style="color:#a6e22e">textContent</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">message</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">status</span>.<span style="color:#a6e22e">className</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;status&#39;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">reconnect</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">socket</span>.<span style="color:#a6e22e">readyState</span> <span style="color:#f92672">===</span> <span style="color:#a6e22e">WebSocket</span>.<span style="color:#a6e22e">CLOSED</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">socket</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">WebSocket</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">socket</span>.<span style="color:#a6e22e">url</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">init</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Khởi tạo khi trang tải
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>document.<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#39;DOMContentLoaded&#39;</span>, () =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">RealTimeChat</span>(<span style="color:#e6db74">&#39;ws://localhost:8080/chat&#39;</span>);
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://nhittt29.github.io/MyTechTales/tags/javascript/">JavaScript</a></li>
      <li><a href="https://nhittt29.github.io/MyTechTales/tags/websocket/">WebSocket</a></li>
      <li><a href="https://nhittt29.github.io/MyTechTales/tags/th%E1%BB%9Di-gian-th%E1%BB%B1c/">Thời Gian Thực</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://nhittt29.github.io/MyTechTales/blog/javascript/nodejs-server/">
    <span class="title">« Prev</span>
    <br>
    <span>Tối ưu hóa server mạng với Node.js và JavaScript</span>
  </a>
  <a class="next" href="https://nhittt29.github.io/MyTechTales/blog/javascript/json-js/">
    <span class="title">Next »</span>
    <br>
    <span>Xử lý dữ liệu JSON với JavaScript trong mạng</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
</body>

</html>
